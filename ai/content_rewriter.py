#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–æ–¥ —Å—Ç–∏–ª—å —Ü–µ–ª–µ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞
"""

import asyncio
from typing import Dict, List, Optional, Any
from dataclasses import dataclass

try:
    import openai
except ImportError:
    openai = None

 

from loguru import logger

@dataclass
class SourcePost:
    """–ò—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Å—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞-–∏—Å—Ç–æ—á–Ω–∏–∫–∞"""
    id: int
    text: str
    channel_id: int
    channel_title: str
    date: str
    views: int
    forwards: int
    url: Optional[str] = None
    media_type: Optional[str] = None  # 'photo', 'video', 'document', 'animation'
    media_object: Optional[Any] = None  # –û–±—ä–µ–∫—Ç –º–µ–¥–∏–∞ –∏–∑ Telegram
    media_url: Optional[str] = None  # URL –º–µ–¥–∏–∞ —Ñ–∞–π–ª–∞
    source_type: str = "telegram"  # telegram
    original_url: Optional[str] = None  # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç

@dataclass
class RewrittenPost:
    """–ü–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π –ø–æ—Å—Ç"""
    original_post: SourcePost
    rewritten_text: str
    hashtags: List[str]
    style: str
    provider: str
    model: str
    processing_time: float
    media_type: Optional[str] = None  # –ö–æ–ø–∏—Ä—É–µ–º –º–µ–¥–∏–∞ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
    media_object: Optional[Any] = None
    media_url: Optional[str] = None

class ContentRewriter:
    """–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–¥ —Å—Ç–∏–ª—å —Ü–µ–ª–µ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞"""
    
    def __init__(self, config):
        self.config = config
        self.setup_ai_clients()
        
        # –°—Ç–∏–ª—å –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è (–±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –ø–æ–∑–∂–µ)
        self.rewriting_style = {
            "tone": "engaging",  # formal, casual, engaging, humorous
            "length": "adaptive",  # short, medium, long, adaptive
            "language": "ru",  # ru, en, mixed
            "add_emojis": False,
            "add_hashtags": False,
            "add_questions": False,
            "personal_touch": True
        }
        
        
    
    def setup_ai_clients(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ OpenAI)."""
        if openai is None:
            logger.error("–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ openai –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")
            return
        openai.api_key = self.config.AI_API_KEY
        self.openai_client = openai.AsyncOpenAI(api_key=self.config.AI_API_KEY)
        logger.info("OpenAI –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω")
    
    async def rewrite_post(self, source_post: SourcePost) -> RewrittenPost:
        """–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—Å—Ç –ø–æ–¥ —Å—Ç–∏–ª—å —Ü–µ–ª–µ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞"""
        import time
        start_time = time.time()
        
        try:
            rewritten_text = await self._rewrite_with_openai(source_post)
            
            # –û—á–∏—â–∞–µ–º –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
            cleaned_text = self._clean_and_format_text(rewritten_text)
            
            # –£–±–∏—Ä–∞–µ–º —Ö–µ—à—Ç–µ–≥–∏ –∏ –ø–æ–¥–ø–∏—Å—å, –µ—Å–ª–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç—å –∏—Ö –¥–æ–±–∞–≤–∏–ª–∞
            cleaned_text = self._remove_hashtags_from_text(cleaned_text)
            
            # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç
            final_text = self._format_simple_post(cleaned_text, [])
            
            processing_time = time.time() - start_time
            
            logger.info(f"–ü–æ—Å—Ç –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –∑–∞ {processing_time:.2f}—Å")
            
            return RewrittenPost(
                original_post=source_post,
                rewritten_text=final_text,
                hashtags=[],
                style=self.rewriting_style["tone"],
                provider=self.config.AI_PROVIDER,
                model=self.config.AI_MODEL,
                media_type=source_post.media_type,
                media_object=source_post.media_object,
                media_url=source_post.media_url,
                processing_time=processing_time
            )
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –ø–æ—Å—Ç–∞: {e}")
            logger.error(f"–¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
            logger.error(f"–î–µ—Ç–∞–ª–∏: {str(e)}")
            logger.warning("–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback —Ä–µ–∂–∏–º (—à–∞–±–ª–æ–Ω–Ω—ã–π –ø–æ—Å—Ç). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.")
            return self._create_fallback_post(source_post)
    
    async def _rewrite_with_openai(self, source_post: SourcePost) -> str:
        """–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ OpenAI"""
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        if not hasattr(self, 'openai_client') or self.openai_client is None:
            raise Exception("OpenAI –∫–ª–∏–µ–Ω—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")
        
        prompt = self._build_rewriting_prompt(source_post)
        
        try:
            response = await self.openai_client.chat.completions.create(
                model=self.config.AI_MODEL,
                messages=[
                    {"role": "system", "content": self._get_system_prompt()},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=800,
                temperature=0.7
            )
            
            if not response.choices or not response.choices[0].message.content:
                raise Exception("OpenAI –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç")
            
            return response.choices[0].message.content.strip()
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ OpenAI API: {e}")
            raise  # –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–ª—å—à–µ, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö
    
    
    
    def _build_rewriting_prompt(self, source_post: SourcePost) -> str:
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è"""
        prompt = f"""
–¢–´ –î–û–õ–ñ–ï–ù –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ü–ò–°–ê–¢–¨ —ç—Ç–æ—Ç –ø–æ—Å—Ç –≤ —Å—Ç–∏–ª–µ –∞–≤—Ç–æ—Ä–∞ @thedegeton. –ù–ï –ö–û–ü–ò–†–£–ô –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç!

–ò–°–•–û–î–ù–´–ô –ü–û–°–¢:
{source_post.text}

–ó–ê–î–ê–ß–ê: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç –≤ —Å—Ç–∏–ª–µ @thedegeton, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –ö–û–ù–ö–†–ï–¢–ù–´–ï –¥–µ—Ç–∞–ª–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞!

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
- –°–æ—Ö—Ä–∞–Ω—è–π –í–°–ï –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤, —Ü–∏—Ñ—Ä—ã, –¥–∞—Ç—ã, –∫—É—Ä—Å—ã, —Å—É–º–º—ã
- –ï—Å–ª–∏ –≤ –ø–æ—Å—Ç–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç "Capybobo" - —É–ø–æ–º—è–Ω–∏ –µ–≥–æ, –Ω–µ –ø–∏—à–∏ –æ–± "–∏–≥—Ä–æ–≤–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏" –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ
- –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞ (160,904 CAPY) - —Å–æ—Ö—Ä–∞–Ω–∏ –∏—Ö –∏–ª–∏ —É–∫–∞–∂–∏, —á—Ç–æ –±—ã–ª–æ —É–∫–∞–∑–∞–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ
- –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞—Ç—ã (5 –Ω–æ—è–±—Ä—è, 10 –Ω–æ—è–±—Ä—è) - —Å–æ—Ö—Ä–∞–Ω–∏ –∏—Ö
- –ù–ï –∑–∞–º–µ–Ω—è–π –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É –æ–±—â–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏ —Ç–∏–ø–∞ "–∏–≥—Ä–æ–≤–∞—è –∏–Ω–¥—É—Å—Ç—Ä–∏—è", "–Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã"
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ß–¢–û –ö–û–ù–ö–†–ï–¢–ù–û –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π –≠–¢–û, –∞ –Ω–µ –æ–±—â—É—é —Ç–µ–º—É

–°–¢–ò–õ–¨ –ê–í–¢–û–†–ê @thedegeton - —Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–π:

üéØ –°–¢–†–£–ö–¢–£–†–ê –ü–û–°–¢–ê:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–±–∑–∞—Ü–µ–≤ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
- –í –∫–∞–∂–¥–æ–º –∞–±–∑–∞—Ü–µ 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–ø–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é)
- –¢–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∂–∏—Ä–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫: 1-3 —Å–ª–æ–≤–∞ –ø–æ —Å–º—ã—Å–ª—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ (–ù–ï —à–∞–±–ª–æ–Ω–Ω—ã–π!)
- –ü–æ–¥–ø–∏—Å—å @thedegeton –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

üìå –ó–ê–ì–û–õ–û–í–û–ö (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ –∏ —Å–æ–∑–¥–∞–≤–∞–π –£–ù–ò–ö–ê–õ–¨–ù–´–ô –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ 1-3 —Å–ª–æ–≤
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å –ì–õ–ê–í–ù–£–Æ –°–£–¢–¨ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞, –∞ –Ω–µ –æ–±—â–∏–µ —Ç–µ–º—ã
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω—ã: "–û–±–∑–æ—Ä —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã TON", "–ê–Ω–∞–ª–∏–∑ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã", "–ù–æ–≤–æ—Å—Ç–∏ –±–ª–æ–∫—á–µ–π–Ω–∞"
- –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ: "TON –æ–±–Ω–æ–≤–ª—ë–Ω", "Bitcoin –≤—ã—Ä–æ—Å", "–ù–æ–≤—ã–π –∫–æ—à–µ–ª—ë–∫"
- –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç = —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é!

üó£ –Ø–ó–´–ö –ò –¢–û–ù:
- –°—Ç—Ä–æ–≥–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–ª–µ–Ω–≥: "–ª–∞–¥–Ω–æ", "–Ω—É –∞ —á—Ç–æ"
- –î–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
- –°–¥–µ—Ä–∂–∞–Ω–Ω–∞—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: "–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ", "—Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å", "–≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å"
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: "–¥—É–º–∞—é —á—Ç–æ", "—Å—É–¥—è –ø–æ –¥–∞–Ω–Ω—ã–º", "–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–º–µ—Ç–∏—Ç—å"

üìù –°–û–î–ï–†–ñ–ê–ù–ò–ï:
- –°–æ—Ö—Ä–∞–Ω—è–π –í–°–ï –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤, —Ü–∏—Ñ—Ä—ã, –¥–∞—Ç—ã, —Å–æ–±—ã—Ç–∏—è
- –ù–ï –∑–∞–º–µ–Ω—è–π –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É –æ–±—â–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏ (–µ—Å–ª–∏ –ø—Ä–æ "Capybobo" - –ø–∏—à–∏ –ø—Ä–æ Capybobo, –Ω–µ –ø—Ä–æ "–∏–≥—Ä–æ–≤—É—é –∏–Ω–¥—É—Å—Ç—Ä–∏—é")
- –¢–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
- –ë–µ–∑ –ª–∏—à–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –ß–µ—Ç–∫–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏

üé® –û–°–û–ë–ï–ù–ù–û–°–¢–ò –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–±–∑–∞—Ü–µ–≤ –≤—ã–±–∏—Ä–∞–π –ø–æ –æ–±—ä–µ–º—É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
- –í –∫–∞–∂–¥–æ–º –∞–±–∑–∞—Ü–µ 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∂–∏—Ä–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫: 1-3 —Å–ª–æ–≤–∞ –ø–æ —Å–º—ã—Å–ª—É –ø–æ—Å—Ç–∞ (–ù–ï —à–∞–±–ª–æ–Ω–Ω—ã–π!)
- –¢–æ–ª—å–∫–æ —Å—É—Ç—å, –±–µ–∑ –≤–æ–¥—ã

–ü–†–ò–ú–ï–†–´ –§–†–ê–ó –í –°–¢–ò–õ–ï:
- "–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
- "–í–∞–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è..."
- "–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∫—Ç—ã..."
- "–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ..."
- "–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."

–í–ê–ñ–ù–û: 
- –ù–ï –ö–û–ü–ò–†–£–ô –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–æ –°–û–•–†–ê–ù–Ø–ô –≤—Å–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã!
- –ï—Å–ª–∏ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –ø—Ä–æ –ø—Ä–æ–µ–∫—Ç "Capybobo" - –ø–∏—à–∏ –ø—Ä–æ Capybobo, –Ω–µ –æ–± "–∏–≥—Ä–æ–≤–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏"
- –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, –¥–∞—Ç—ã, –Ω–∞–∑–≤–∞–Ω–∏—è - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–æ—Ö—Ä–∞–Ω–∏ –∏—Ö
- –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ü–ò–®–ò –≤ —Å—Ç–∏–ª–µ @thedegeton, –Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–±–∑–∞—Ü–µ–≤ ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ –¥–ª–∏–Ω–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
- –ö–∞–∂–¥—ã–π –∞–±–∑–∞—Ü —Å–æ–¥–µ—Ä–∂–∏—Ç 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –ó–ê–ì–û–õ–û–í–û–ö: —Å–æ–∑–¥–∞–≤–∞–π –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ø–æ —Å–º—ã—Å–ª—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ (1-3 —Å–ª–æ–≤–∞), –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω—ã —Ç–∏–ø–∞ "–¢–µ–Ω–¥–µ–Ω—Ü–∏–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã"!
- –ó–ê–ì–û–õ–û–í–û–ö –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–µ–º—É –ø–æ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "Capybobo –¥—Ä–æ–ø" –≤–º–µ—Å—Ç–æ "–¢–µ–Ω–¥–µ–Ω—Ü–∏–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã")
- –¢–û–õ–¨–ö–û –∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤
- –ë–ï–ó –ª–∏—à–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –ù–ï –î–û–ë–ê–í–õ–Ø–ô –ø–æ–¥–ø–∏—Å—å @thedegeton –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞ ‚Äî –æ–Ω–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–ï –ó–ê–î–ê–í–ê–ô –≤–æ–ø—Ä–æ—Å—ã –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞
- –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô "p.s." –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–ø–∏—Å–∫–∏
- –î–ï–õ–ê–ô –ø–æ—Å—Ç—ã –ß–ï–¢–ö–ò–ú–ò –∏ –ò–ù–§–û–†–ú–ê–¢–ò–í–ù–´–ú–ò —Å –ö–û–ù–ö–†–ï–¢–ù–´–ú–ò —Ñ–∞–∫—Ç–∞–º–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞

–ü–ï–†–ï–ü–ò–®–ò –ü–û–°–¢ –ü–û–õ–ù–û–°–¢–¨–Æ –≤ —Å—Ç–∏–ª–µ –∞–≤—Ç–æ—Ä–∞ @thedegeton –ë–ï–ó –ø–æ–¥–ø–∏—Å–∏ –≤ –∫–æ–Ω—Ü–µ.
        """
        
        return prompt.strip()
    
    
    def _clean_and_format_text(self, text: str) -> str:
        """–û—á–∏—Å—Ç–∫–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞"""
        import re
        
        # –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –≤—Å–µ —ç–º–æ–¥–∑–∏
        text = self._remove_emojis_from_text(text)
        
        # –£–±–∏—Ä–∞–µ–º ** –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∏ –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –∂–∏—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        text = re.sub(r'\*\*(.*?)\*\*', r'<b>\1</b>', text)
        
        # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã
        text = re.sub(r'\n\s*\n\s*\n', '\n\n', text)
        text = text.strip()
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ - –∏–∑–≤–ª–µ–∫–∞–µ–º –∏—Ö –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –≤ –ø–æ—Ö–æ–∂–∏–µ —Å–ª–æ–≤–∞
        # –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è, –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
        text = self._process_links(text)
        
        return text
    
    def _remove_emojis_from_text(self, text: str) -> str:
        """–£–¥–∞–ª—è–µ—Ç –≤—Å–µ —ç–º–æ–¥–∑–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞"""
        import re
        
        # –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç–º–æ–¥–∑–∏ (Unicode –¥–∏–∞–ø–∞–∑–æ–Ω—ã)
        emoji_pattern = re.compile(
            "["
            "\U0001F600-\U0001F64F"  # —ç–º–æ—Ü–∏–∏
            "\U0001F300-\U0001F5FF"  # —Å–∏–º–≤–æ–ª—ã –∏ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã
            "\U0001F680-\U0001F6FF"  # —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
            "\U0001F1E0-\U0001F1FF"  # —Ñ–ª–∞–≥–∏
            "\U00002702-\U000027B0"  # —Å–∏–º–≤–æ–ª—ã
            "\U000024C2-\U0001F251"  # –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
            "\U0001F900-\U0001F9FF"  # –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã
            "\U0001FA70-\U0001FAFF"  # —Å–∏–º–≤–æ–ª—ã –∏ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ
            "\U00002600-\U000026FF"  # —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
            "\U00002700-\U000027BF"  # Dingbats
            "]+", 
            flags=re.UNICODE
        )
        
        return emoji_pattern.sub('', text)
    
    def _remove_hashtags_from_text(self, text: str) -> str:
        """–£–¥–∞–ª—è–µ—Ç —Ö–µ—à—Ç–µ–≥–∏, —ç–º–æ–¥–∑–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞, –µ—Å–ª–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç—å –∏—Ö –¥–æ–±–∞–≤–∏–ª–∞"""
        import re
        
        # –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º —ç–º–æ–¥–∑–∏
        text = self._remove_emojis_from_text(text)
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ —Ö–µ—à—Ç–µ–≥–∏
        lines = text.split('\n')
        cleaned_lines = []
        
        for line in lines:
            line = line.strip()
            # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ö–µ—à—Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å #) –∏–ª–∏ –ø–æ–¥–ø–∏—Å—å @thedegeton, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—ë
            if line and (all(word.startswith('#') for word in line.split()) or line.startswith('@thedegeton')):
                continue
            cleaned_lines.append(line)
        
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ
        result = '\n'.join(cleaned_lines)
        
        # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
        result = re.sub(r'\n\s*\n\s*\n', '\n\n', result)
        
        return result.strip()
    
    def _format_simple_post(self, text: str, hashtags: List[str]) -> str:
        """–ü—Ä–æ—Å—Ç–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ –±–µ–∑ —ç–º–æ–¥–∑–∏"""
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å @thedegeton –≤ –∫–æ–Ω–µ—Ü
        return f"{text}\n\n@thedegeton"
    
    
    
    def _process_links(self, text: str) -> str:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–æ–∫ –≤ —Ç–µ–∫—Å—Ç–µ"""
        import re
        
        # –ù–∞—Ö–æ–¥–∏–º —Å—Å—ã–ª–∫–∏ –≤ —Å–∫–æ–±–∫–∞—Ö
        link_pattern = r'\(([^)]*https?://[^)]*)\)'
        links = re.findall(link_pattern, text)
        
        # –£–±–∏—Ä–∞–µ–º —Å—Å—ã–ª–∫–∏ –≤ —Å–∫–æ–±–∫–∞—Ö –∏–∑ —Ç–µ–∫—Å—Ç–∞
        text = re.sub(link_pattern, '', text)
        
        # –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º —Å—Å—ã–ª–∫–∏, –ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É
        # –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∏—Ö –≤ –ø–æ—Ö–æ–∂–∏–µ –ø–æ —Å–º—ã—Å–ª—É —Å–ª–æ–≤–∞
        
        return text

    def extract_links(self, text: str) -> List[str]:
        """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ —Å—Å—ã–ª–∫–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞, –≤–∫–ª—é—á–∞—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ —Å–ª–æ–≤–∞ (markdown) –∏ –æ–±—ã—á–Ω—ã–µ URL."""
        import re
        urls: List[str] = []
        
        # Markdown-—Å—Å—ã–ª–∫–∏ –≤–∏–¥–∞ [—Ç–µ–∫—Å—Ç](https://example.com/path)
        markdown_links = re.findall(r'\[[^\]]+\]\((https?://[^)\s]+)\)', text)
        urls.extend(markdown_links)
        
        # –û–±—ã—á–Ω—ã–µ http/https URL
        bare_urls = re.findall(r'(https?://[^\s)]+)', text)
        urls.extend(bare_urls)
        
        # –°—Å—ã–ª–∫–∏, –ø–æ–ø–∞–≤—à–∏–µ –≤–Ω—É—Ç—Ä—å —Å–∫–æ–±–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑–Ω—É—Ç—Ä–∏, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —Ä–∞–Ω–µ–µ
        in_parens = re.findall(r'\(([^)]*https?://[^)]*)\)', text)
        for chunk in in_parens:
            for m in re.findall(r'(https?://[^\s)]+)', chunk):
                urls.append(m)
        
        # –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ—Ä—è–¥–æ–∫
        seen = set()
        unique_urls: List[str] = []
        for u in urls:
            if u not in seen:
                seen.add(u)
                unique_urls.append(u)
        return unique_urls
    
    def _get_system_prompt(self) -> str:
        """–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI"""
        return """–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ —Å—Ç–∏–ª–µ –∞–≤—Ç–æ—Ä–∞ @thedegeton. 

–¢–í–û–Ø –†–û–õ–¨: –¢—ã –ø–∏—à–µ—à—å –∫–∞–∫ –æ–ø—ã—Ç–Ω—ã–π –∫—Ä–∏–ø—Ç–æ-–±–ª–æ–≥–µ—Ä —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Å—Ç–∏–ª–µ–º –ø–æ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
- –°–æ—Ö—Ä–∞–Ω—è–π –í–°–ï –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤, —Ü–∏—Ñ—Ä—ã, –¥–∞—Ç—ã, –∫—É—Ä—Å—ã, —Å—É–º–º—ã
- –ï—Å–ª–∏ –≤ –ø–æ—Å—Ç–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä "Capybobo") - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–ø–æ–º—è–Ω–∏ –µ–≥–æ, –Ω–µ –∑–∞–º–µ–Ω—è–π –æ–±—â–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏
- –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞, –¥–∞—Ç—ã, —Å–æ–±—ã—Ç–∏—è - —Å–æ—Ö—Ä–∞–Ω–∏ –∏—Ö –≤ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
- –ù–ï –∑–∞–º–µ–Ω—è–π –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É –æ–±—â–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏ —Ç–∏–ø–∞ "–∏–≥—Ä–æ–≤–∞—è –∏–Ω–¥—É—Å—Ç—Ä–∏—è", "–Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã"
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ß–¢–û –ö–û–ù–ö–†–ï–¢–ù–û –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π –≠–¢–û, –∞ –Ω–µ –æ–±—â—É—é —Ç–µ–º—É

–°–¢–ò–õ–¨ –ê–í–¢–û–†–ê:
- –°—Ç—Ä–æ–≥–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ª–µ–Ω–≥–∞: "–ª–∞–¥–Ω–æ", "–Ω—É –∞ —á—Ç–æ"
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –º–Ω–µ–Ω–∏—è
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–∞—á–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
- –†–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è —Ä–µ—á—å —Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è–º–∏

–¢–ï–ú–ê–¢–ò–ö–ê:
- Web3 –∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
- TON —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞
- –ë–ª–æ–∫—á–µ–π–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –∏ —Ç—Ä–µ–Ω–¥–æ–≤
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è —Ç—Ä–µ–π–¥–µ—Ä–æ–≤

–°–¢–†–£–ö–¢–£–†–ê:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–±–∑–∞—Ü–µ–≤ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
- –í –∫–∞–∂–¥–æ–º –∞–±–∑–∞—Ü–µ 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∂–∏—Ä–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫: 1-3 —Å–ª–æ–≤–∞ –ø–æ —Å–º—ã—Å–ª—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ (–ù–ï —à–∞–±–ª–æ–Ω–Ω—ã–π!)
- –¢–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –ü–æ–¥–ø–∏—Å—å @thedegeton –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ó–ê–ì–û–õ–û–í–û–ö:
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞ –∏ —Å–æ–∑–¥–∞–≤–∞–π –£–ù–ò–ö–ê–õ–¨–ù–´–ô –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ 1-3 —Å–ª–æ–≤
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å –ì–õ–ê–í–ù–£–Æ –°–£–¢–¨ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω—ã —Ç–∏–ø–∞ "–û–±–∑–æ—Ä —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã TON", "–ê–Ω–∞–ª–∏–∑ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã"
- –°–æ–∑–¥–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–æ —Å–º—ã—Å–ª—É: "TON –æ–±–Ω–æ–≤–ª—ë–Ω", "Bitcoin –≤—ã—Ä–æ—Å", "–ù–æ–≤—ã–π –∫–æ—à–µ–ª—ë–∫"
- –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç = —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫!

–Ø–ó–´–ö–û–í–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò:
- "–ª–∞–¥–Ω–æ", "–Ω—É –∞ —á—Ç–æ"
- "–≤—Å—ë –∫–∞–∫ –≤—Å–µ–≥–¥–∞", "–Ω–∏—á–µ–≥–æ –Ω–æ–≤–æ–≥–æ"
- "–¥—É–º–∞—é —á—Ç–æ", "—Å—É–¥—è –ø–æ –¥–∞–Ω–Ω—ã–º"

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–±–∑–∞—Ü–µ–≤ ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ –¥–ª–∏–Ω–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
- –í –∫–∞–∂–¥–æ–º –∞–±–∑–∞—Ü–µ 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –ó–ê–ì–û–õ–û–í–û–ö: —Å–æ–∑–¥–∞–≤–∞–π –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ø–æ —Å–º—ã—Å–ª—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ (1-3 —Å–ª–æ–≤–∞), –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω—ã —Ç–∏–ø–∞ "–¢–µ–Ω–¥–µ–Ω—Ü–∏–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã"!
- –ó–ê–ì–û–õ–û–í–û–ö –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–µ–º—É –ø–æ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "Capybobo –¥—Ä–æ–ø" –≤–º–µ—Å—Ç–æ "–¢–µ–Ω–¥–µ–Ω—Ü–∏–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã")
- –°–æ—Ö—Ä–∞–Ω—è–π –í–°–ï –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã: –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤, —Ü–∏—Ñ—Ä—ã, –¥–∞—Ç—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
- –ù–ï –∑–∞–º–µ–Ω—è–π –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É –æ–±—â–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏ (–µ—Å–ª–∏ –ø—Ä–æ "Capybobo" - –ø–∏—à–∏ –ø—Ä–æ Capybobo)
- –¢–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤
- –ë–ï–ó –ª–∏—à–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –°–æ—Ö—Ä–∞–Ω—è–π –æ—Å–Ω–æ–≤–Ω—É—é —Å—É—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ö–û–ù–ö–†–ï–¢–ù–´–ú–ò –¥–µ—Ç–∞–ª—è–º–∏
- –ù–ï –ó–ê–î–ê–í–ê–ô –≤–æ–ø—Ä–æ—Å—ã –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞
- –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô "p.s." –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–ø–∏—Å–∫–∏
- –ß–ï–¢–ö–û –∏ –ò–ù–§–û–†–ú–ê–¢–ò–í–ù–û —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞

–í—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏ –¥–µ—Ç–∞–ª–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—è –∏—Ö –≤ —É–∑–Ω–∞–≤–∞–µ–º–æ–º —Å—Ç–∏–ª–µ –∞–≤—Ç–æ—Ä–∞."""
    
    
    
    
    
    
    
    def _rewrite_fallback(self, source_post: SourcePost) -> str:
        """–†–µ–∑–µ—Ä–≤–Ω–æ–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –±–µ–∑ AI –≤ —Å—Ç–∏–ª–µ –∞–≤—Ç–æ—Ä–∞"""
        import re
        text = source_post.text
        
        # –£–¥–∞–ª—è–µ–º —ç–º–æ–¥–∑–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        text = self._remove_emojis_from_text(text)
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
        # –ò—â–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ (—Å–ª–æ–≤–∞ —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã)
        projects = re.findall(r'\b[A-Z][a-zA-Z]+\b', text)
        # –ò—â–µ–º —Ü–∏—Ñ—Ä—ã
        numbers = re.findall(r'\d+[.,]\d+|\d+', text)
        # –ò—â–µ–º –¥–∞—Ç—ã
        dates = re.findall(r'\d+\s*(?:–Ω–æ—è–±—Ä—è|–¥–µ–∫–∞–±—Ä—è|—è–Ω–≤–∞—Ä—è|—Ñ–µ–≤—Ä–∞–ª—è|–º–∞—Ä—Ç–∞|–∞–ø—Ä–µ–ª—è|–º–∞—è|–∏—é–Ω—è|–∏—é–ª—è|–∞–≤–≥—É—Å—Ç–∞|—Å–µ–Ω—Ç—è–±—Ä—è|–æ–∫—Ç—è–±—Ä—è)|(?:–Ω–æ—è–±—Ä—è|–¥–µ–∫–∞–±—Ä—è|—è–Ω–≤–∞—Ä—è|—Ñ–µ–≤—Ä–∞–ª—è|–º–∞—Ä—Ç–∞|–∞–ø—Ä–µ–ª—è|–º–∞—è|–∏—é–Ω—è|–∏—é–ª—è|–∞–≤–≥—É—Å—Ç–∞|—Å–µ–Ω—Ç—è–±—Ä—è|–æ–∫—Ç—è–±—Ä—è)\s*\d+', text, re.IGNORECASE)
        
        # –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–ª–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
        text_words = text.split()
        # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ –∑–Ω–∞—á–∏–º—ã–µ —Å–ª–æ–≤–∞ (–ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ)
        significant_words = [w for w in text_words[:10] if len(w) > 3 and not w.lower() in ['—ç—Ç–æ', '—á—Ç–æ', '–¥–ª—è', '–∫–∞–∫', '–∏–ª–∏', '–±—ã–ª', '–±—ã–ª', '–µ—Å—Ç—å']]
        
        if projects:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
            header = f"<b>{projects[0]}</b>"
        elif significant_words:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞
            header_keyword = significant_words[0].capitalize()
            header = f"<b>{header_keyword}</b>"
        else:
            header = "<b>–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</b>"
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π (—Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
        # –≠—Ç–æ –ª—É—á—à–µ, —á–µ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã
        cleaned_text = re.sub(r'\n+', '\n\n', text.strip())
        
        # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π, –æ–±—Ä–µ–∑–∞–µ–º
        if len(cleaned_text) > 500:
            cleaned_text = cleaned_text[:500] + "..."
        
        return f"{header}\n\n{cleaned_text}"
    
    def _rewrite_content_in_style(self, original_text: str, topic: str) -> str:
        """–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ"""
        # –£–¥–∞–ª—è–µ–º —ç–º–æ–¥–∑–∏
        text = self._remove_emojis_from_text(original_text)
        
        # –£–±–∏—Ä–∞–µ–º ** –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        text = text.replace("**", "")
        
        # –£–±–∏—Ä–∞–µ–º —Å—Å—ã–ª–∫–∏ –≤ —Å–∫–æ–±–∫–∞—Ö
        import re
        text = re.sub(r'\([^)]*https?://[^)]*\)', '', text)
        
        # –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º –≤ —Å—Ç–∏–ª–µ –∞–≤—Ç–æ—Ä–∞ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
        if "bitcoin" in text.lower() or "–∫—Ä–∏–ø—Ç" in text.lower():
            return f"–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–π —Ä—ã–Ω–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å. –¶–µ–Ω—ã –∫–æ–ª–µ–±–ª—é—Ç—Å—è, —Ç—Ä–µ–±—É—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. –°—Ç–æ–∏—Ç —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ç—Ä–µ–Ω–¥–∞–º–∏."
        elif "ton" in text.lower() or "—Ç–µ–ª–µ–≥—Ä–∞–º" in text.lower():
            return f"TON —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–Ω–æ. –ù–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤. –í–∞–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è."
        elif "–∏–≥—Ä–∞" in text.lower() or "gamefi" in text.lower():
            return f"–ò–≥—Ä–æ–≤–∞—è –∏–Ω–¥—É—Å—Ç—Ä–∏—è –≤ Web3 –Ω–∞–±–∏—Ä–∞–µ—Ç –æ–±–æ—Ä–æ—Ç—ã. –ù–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏. –°—Ç–æ–∏—Ç –∏–∑—É—á–∏—Ç—å –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã."
        else:
            return f"–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–µ–∫—Ç–æ—Ä —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è. –ü–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è. –í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è."
    
    def _create_fallback_post(self, source_post: SourcePost) -> RewrittenPost:
        """–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ"""
        rewritten_text = self._rewrite_fallback(source_post)
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø–æ—Å—Ç
        final_text = self._format_simple_post(rewritten_text, [])
        
        return RewrittenPost(
            original_post=source_post,
            rewritten_text=final_text,
            hashtags=[],
            style="fallback",
            provider="fallback",
            model="template",
            media_type=source_post.media_type,
            media_object=source_post.media_object,
            media_url=source_post.media_url,
            processing_time=0.0
        )
    
    def update_style(self, style_config: Dict):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è"""
        self.rewriting_style.update(style_config)
        logger.info("–°—Ç–∏–ª—å –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω")
    
    def get_style_config(self) -> Dict:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∏–ª—è"""
        return self.rewriting_style.copy()
    
    def add_custom_emojis(self, emojis: List[str]):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —ç–º–æ–¥–∑–∏ –≤ –Ω–∞–±–æ—Ä –∞–≤—Ç–æ—Ä–∞"""
        self.author_emojis.extend(emojis)
        self.author_emojis = list(set(self.author_emojis))  # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏
        logger.info(f"–î–æ–±–∞–≤–ª–µ–Ω–æ {len(emojis)} –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —ç–º–æ–¥–∑–∏")
    
    def set_emoji_mapping(self, mapping: Dict[str, List[str]]):
        """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —ç–º–æ–¥–∑–∏"""
        self.context_emojis.update(mapping)
        logger.info("–û–±–Ω–æ–≤–ª–µ–Ω–æ –º–∞–ø–ø–∏–Ω–≥ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —ç–º–æ–¥–∑–∏")
    
    def get_available_emojis(self) -> List[str]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —ç–º–æ–¥–∑–∏"""
        return self.author_emojis.copy()
    
    def set_premium_emojis(self, premium_emojis: Dict[str, str]):
        """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Premium —ç–º–æ–¥–∑–∏ (file_id —Å—Ç–∏–∫–µ—Ä–æ–≤)"""
        self.premium_emojis.update(premium_emojis)
        logger.info(f"–û–±–Ω–æ–≤–ª–µ–Ω–æ {len(premium_emojis)} Premium —ç–º–æ–¥–∑–∏")
    
    def get_premium_emojis(self) -> Dict[str, str]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ Premium —ç–º–æ–¥–∑–∏"""
        return self.premium_emojis.copy()
